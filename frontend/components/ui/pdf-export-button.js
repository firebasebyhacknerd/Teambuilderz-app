import React, { useState } from 'react';\nimport { Download, Loader2 } from 'lucide-react';\nimport { Button } from './button';\nimport { motion } from 'framer-motion';\nimport API_URL from '../../lib/api';\n\nconst PDFExportButton = ({ \n  reportType, \n  data = {}, \n  filename = 'report',\n  className = '',\n  disabled = false,\n  size = 'default',\n  variant = 'default'\n}) => {\n  const [isExporting, setIsExporting] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleExport = async () => {\n    if (isExporting || disabled) return;\n\n    setIsExporting(true);\n    setError('');\n\n    try {\n      // Get user info from localStorage\n      const token = localStorage.getItem('token');\n      const userRole = localStorage.getItem('userRole');\n      const userId = localStorage.getItem('userId');\n\n      if (!token) {\n        throw new Error('Authentication required');\n      }\n\n      // Prepare request headers\n      const headers = {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`,\n        'x-user-role': userRole || '',\n        'x-user-id': userId || ''\n      };\n\n      // Make API request to generate PDF\n      const response = await fetch(`${API_URL}/api/v1/pdf/${reportType}`, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(data)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.message || 'Failed to generate PDF');\n      }\n\n      // Get the PDF blob\n      const pdfBlob = await response.blob();\n      \n      // Create download link\n      const url = window.URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      \n      // Generate filename with timestamp\n      const timestamp = new Date().toISOString().split('T')[0];\n      const finalFilename = `${filename}-${timestamp}.pdf`;\n      link.download = finalFilename;\n      \n      // Trigger download\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      // Clean up\n      window.URL.revokeObjectURL(url);\n      \n    } catch (err) {\n      console.error('PDF export error:', err);\n      setError(err.message || 'Failed to export PDF');\n      \n      // Show error for 3 seconds\n      setTimeout(() => setError(''), 3000);\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <motion.div\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n      >\n        <Button\n          onClick={handleExport}\n          disabled={isExporting || disabled}\n          className={`gap-2 ${className}`}\n          size={size}\n          variant={variant}\n        >\n          {isExporting ? (\n            <>\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span>Exporting...</span>\n            </>\n          ) : (\n            <>\n              <Download className=\"h-4 w-4\" />\n              <span>Export PDF</span>\n            </>\n          )}\n        </Button>\n      </motion.div>\n      \n      {/* Error message */}\n      {error && (\n        <motion.div\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -10 }}\n          className=\"absolute top-full left-0 right-0 mt-2 p-2 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm whitespace-nowrap z-10\"\n        >\n          {error}\n        </motion.div>\n      )}\n    </div>\n  );\n};\n\nexport default PDFExportButton;
