import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Search, X, Clock, FileText, Users, Calendar } from 'lucide-react';\nimport { Input } from './input';\nimport { Button } from './button';\nimport { useRouter } from 'next/router';\n\nconst SearchInput = ({ placeholder = \"Search...\", className = '' }) => {\n  const router = useRouter();\n  const [isOpen, setIsOpen] = useState(false);\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [recentSearches, setRecentSearches] = useState([]);\n  const inputRef = useRef(null);\n  const searchRef = useRef(null);\n\n  // Mock search function - replace with actual API call\n  const performSearch = async (searchQuery) => {\n    if (!searchQuery.trim()) return [];\n    \n    setLoading(true);\n    // Simulate API delay\n    await new Promise(resolve => setTimeout(resolve, 300));\n    \n    // Mock results based on query\n    const mockResults = [\n      {\n        id: 1,\n        type: 'candidate',\n        title: 'John Doe',\n        subtitle: 'Software Engineer',\n        href: '/recruiter/candidates/1',\n        icon: Users\n      },\n      {\n        id: 2,\n        type: 'application',\n        title: 'Google Application',\n        subtitle: 'Senior Frontend Developer',\n        href: '/recruiter/applications/2',\n        icon: FileText\n      },\n      {\n        id: 3,\n        type: 'interview',\n        title: 'Technical Interview',\n        subtitle: 'Tomorrow at 2:00 PM',\n        href: '/recruiter/interviews/3',\n        icon: Calendar\n      }\n    ].filter(item => \n      item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      item.subtitle.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n    \n    setLoading(false);\n    return mockResults;\n  };\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (searchRef.current && !searchRef.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  useEffect(() => {\n    const savedSearches = localStorage.getItem('recentSearches');\n    if (savedSearches) {\n      try {\n        setRecentSearches(JSON.parse(savedSearches));\n      } catch (e) {\n        console.error('Failed to parse recent searches');\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    if (query.trim()) {\n      const timer = setTimeout(async () => {\n        const searchResults = await performSearch(query);\n        setResults(searchResults);\n      }, 300);\n\n      return () => clearTimeout(timer);\n    } else {\n      setResults([]);\n    }\n  }, [query]);\n\n  const handleInputChange = (e) => {\n    setQuery(e.target.value);\n    setIsOpen(true);\n  };\n\n  const handleResultClick = (result) => {\n    // Add to recent searches\n    const newRecentSearches = [\n      { query: result.title, type: result.type, timestamp: Date.now() },\n      ...recentSearches.filter(s => s.query !== result.title).slice(0, 4)\n    ];\n    setRecentSearches(newRecentSearches);\n    localStorage.setItem('recentSearches', JSON.stringify(newRecentSearches));\n    \n    // Navigate to result\n    router.push(result.href);\n    setIsOpen(false);\n    setQuery('');\n  };\n\n  const handleRecentSearchClick = (search) => {\n    setQuery(search.query);\n    setIsOpen(true);\n  };\n\n  const clearRecentSearches = () => {\n    setRecentSearches([]);\n    localStorage.removeItem('recentSearches');\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Escape') {\n      setIsOpen(false);\n    } else if (e.key === 'Enter' && query.trim()) {\n      // Add to recent searches\n      const newRecentSearches = [\n        { query, type: 'manual', timestamp: Date.now() },\n        ...recentSearches.filter(s => s.query !== query).slice(0, 4)\n      ];\n      setRecentSearches(newRecentSearches);\n      localStorage.setItem('recentSearches', JSON.stringify(newRecentSearches));\n    }\n  };\n\n  return (\n    <div ref={searchRef} className={`relative ${className}`}>\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          ref={inputRef}\n          type=\"text\"\n          placeholder={placeholder}\n          value={query}\n          onChange={handleInputChange}\n          onFocus={() => setIsOpen(true)}\n          onKeyDown={handleKeyDown}\n          className=\"pl-10 pr-10\"\n        />\n        {query && (\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => {\n              setQuery('');\n              setResults([]);\n              inputRef.current?.focus();\n            }}\n            className=\"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0\"\n          >\n            <X className=\"h-3 w-3\" />\n          </Button>\n        )}\n      </div>\n\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2 }}\n            className=\"absolute top-full left-0 right-0 mt-2 bg-card border rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto\"\n          >\n            <div className=\"p-2\">\n              {/* Loading State */}\n              {loading && (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n                </div>\n              )}\n\n              {/* Search Results */}\n              {!loading && results.length > 0 && (\n                <div className=\"space-y-1\">\n                  <div className=\"px-3 py-2 text-xs font-medium text-muted-foreground\">\n                    Results\n                  </div>\n                  {results.map((result) => {\n                    const Icon = result.icon;\n                    return (\n                      <motion.button\n                        key={result.id}\n                        initial={{ opacity: 0, x: -10 }}\n                        animate={{ opacity: 1, x: 0 }}\n                        transition={{ duration: 0.1 }}\n                        onClick={() => handleResultClick(result)}\n                        className=\"w-full flex items-center gap-3 p-3 rounded-md hover:bg-accent transition-colors text-left\"\n                      >\n                        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"font-medium truncate\">{result.title}</div>\n                          <div className=\"text-sm text-muted-foreground truncate\">{result.subtitle}</div>\n                        </div>\n                      </motion.button>\n                    );\n                  })}\n                </div>\n              )}\n\n              {/* Recent Searches */}\n              {!loading && results.length === 0 && recentSearches.length > 0 && (\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center justify-between px-3 py-2\">\n                    <div className=\"text-xs font-medium text-muted-foreground\">\n                      Recent Searches\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={clearRecentSearches}\n                      className=\"text-xs h-auto p-1\"\n                    >\n                      Clear\n                    </Button>\n                  </div>\n                  {recentSearches.map((search, index) => (\n                    <motion.button\n                      key={`${search.query}-${index}`}\n                      initial={{ opacity: 0, x: -10 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.05, duration: 0.1 }}\n                      onClick={() => handleRecentSearchClick(search)}\n                      className=\"w-full flex items-center gap-3 p-3 rounded-md hover:bg-accent transition-colors text-left\"\n                    >\n                      <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"flex-1 text-left\">{search.query}</span>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {search.type}\n                      </span>\n                    </motion.button>\n                  ))}\n                </div>\n              )}\n\n              {/* No Results */}\n              {!loading && results.length === 0 && recentSearches.length === 0 && query && (\n                <div className=\"text-center py-8\">\n                  <Search className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n                  <div className=\"text-sm text-muted-foreground\">\n                    No results found for \"{query}\"\n                  </div>\n                </div>\n              )}\n\n              {/* Empty State */}\n              {!loading && results.length === 0 && recentSearches.length === 0 && !query && (\n                <div className=\"text-center py-8\">\n                  <Search className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n                  <div className=\"text-sm text-muted-foreground\">\n                    Start typing to search...\n                  </div>\n                </div>\n              )}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\nexport default SearchInput;
